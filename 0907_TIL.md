# PCB와 Context Switching

## 프로세스 제어 블록(PCB: Process Control Block)

- PCB란
    - 운영체제가 프로세스를 제어하기 위해 정보를 저장해 놓는 곳으로 프로세스의 상태 정보를 저장하는 자료 구조
    - 프로세스가 생성될 때마다 고유의 PCB가 생성되고, 프로세스가 완료되면 PCB도 함께 제거된다
    - CB는 문맥 교환(Context Switch)을 위해서 필요함
    

    
- PCB 생성 과정
    1. 프로그램이 실행된다
    2. 프로세스가 생성된다
    3. 프로세스 주소 공간에 (코드, 데이터, 스택)이 생성된다
    4. 프로세스의 메타 데이터들이 PCB에 저장된다
- PCB가 포함해야 하는 정보(Process Metadata)
    
    
    - 포인터: 프로세스의 현재 위치를 저장하는 포인터 정보
    - 프로세스 상태: 프로세스의 각 상태(생성(New), 준비(Ready), 실행(Running), 대기(Waiting), 종료(Terminated))를 저장한다
    - 프로세스 번호: 프로세스의 식별자인 프로세스 ID 또는 PID를 저장
    - 프로그램 카운터: 프로세스를 위해 실행될 다음 명령어의 주소를 포함하는 카운터를 저장
    - 레지스터: 누산기, 메이스, 레지스터 및 범용 레지스터를 포함하는 CPU 레지스터에 있는 정보
    - 메모리 제한: 페이지 테이블, 세그먼트 테이블 등 운영체제에서 사용하는 메모리 관리 시스템에 대한 정보 포함
    - 열린 파일 목록: 프로세스를 위해 열린 파일 목록을 포함
- 운영체제의 PCB 관리법
    - 프로세스 테이블을 사용하여 각 프로세스의 PCB를 관리한다
    - 앞으로 다시 수행할 대기 중인 프로세스에 관한 저장값을 저장해 두었다가 꺼내 씀
    
    
- PCB 관리 방법
    - Linked List 방식으로 관리된다
        - PCB List Head에 PCB들이 생성될 때마다 붙게 된다
        - 주소값으로 연결이 이루어져 있는 연결 리스트이기 때문에 삽입 및 삭제가 용이하다
        - 프로세스가 생성되면 해당 PCB가 생성되고, 해당 프로세스 완료 시 제거된다

## 문맥 교환(Context Switch)

- 문맥(context): 프로세스의 상태 정보
- 문맥 교환(context switch): 프로세스의 상태 정보를 교환하는 작업
    - 하나의 프로세스가 CPU를 사용 중인 상태에서 다른 프로세스가 CPU를 사용하도록 하기 위해 이전의 프로세스 상태를 PCB에 보관하고 또 다른 프로세스의 정보를 PCB에서 읽어 레지스터에 적재하는 과정
    - 보통 인터럽트가 발생하거나, 실행 중인 CPU 사용 허가 시간을 모두 소모하거나, 입출력을 위해 대기해야 하는 경우에 발생
        - 즉, 프로세스가 Ready → Running, Running → Ready  Running→ Waiting처럼 상태 변경 시 발생
    
    
    - 멀티 태스킹(멀티 프로세싱)이 가능하게 해 준다 → 다수의 프로세스가 하나의 CPU 자원을 나누어 사용할 수 있다
- 오버헤드: 다른 작업을 할 수 없는 문맥 교환 시간
    - 하나의 CPU에서 여러 개의 프로세스가 동시에 수행되는 것처럼 보이는 이유는 문맥 교환이 빠르게 일어나기 때문인데, 교환 중에는 다른 작업을 할 수 없다
    - 해결 방안
        - 문맥 교환이 자주 발생하지 않도록 다중 프로그래밍의 정도를 낮춘다
        - 스택 중심의 장비에서는 Stack 포인터 레지스터를 변경하여 프로세스간 문맥 교환을 수행한다
        - 스레드(Thread)를 이용하여 문맥 교환 부하를 최소화시킨다
- 문맥 교환이 일어나는 시점
    - 멀티 태스킹
        - 멀티 태스킹 환경에서 프로세스 전환 과정에서 문맥 교환이 일어남
        - 선점형 시스템에서는 스케줄러가 프로세스를 전환할 수 있음
    - 인터럽트 처리
        - 인터럽트가 발생할 때 문맥 교환이 일어남
    - 사용자 커널 모드 전환
        - 운영체제에서의 사용자 모드와 커널 모드 사이의 전환이 필요할 때 문맥 교환이 일어날 수 있음
    
    ---
    
    ## 출처
    
    [https://gyoogle.dev/blog/computer-science/operating-system/PCB & Context Switching.html](https://gyoogle.dev/blog/computer-science/operating-system/PCB%20&%20Context%20Switching.html)
    
    https://yoongrammer.tistory.com/53
